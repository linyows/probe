# åˆã‚ã¦ã®ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€Probeã‚’ä½¿ç”¨ã—ã¦Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ˜ãƒ«ã‚¹ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€å¯ç”¨æ€§ã‚’ç›£è¦–ã™ã‚‹å®Œå…¨ãªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚æœ€çµ‚çš„ã«ã€è¤‡æ•°ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ¤œè¨¼ã—ã€å•é¡ŒãŒæ¤œå‡ºã•ã‚ŒãŸã¨ãã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡ã™ã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œã®ç›£è¦–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Œæˆã—ã¾ã™ã€‚

## æ§‹ç¯‰ã™ã‚‹å†…å®¹

ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã¤åŒ…æ‹¬çš„ãªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ï¼š

- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯** - è¤‡æ•°ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–** - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®è¿½è·¡
- **ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼** - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** - è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒã‚§ãƒƒã‚¯
- **ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥** - å•é¡Œæ¤œå‡ºæ™‚ã®ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- **ç’°å¢ƒè¨­å®š** - é–‹ç™ºã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç”¨

## å‰ææ¡ä»¶

- ProbeãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ï¼ˆ[ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰](../get-started/installation/)ï¼‰
- HTTP APIã®åŸºæœ¬çš„ãªç†è§£
- é€šçŸ¥ç”¨ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆGmailã€Office 365ã€ã¾ãŸã¯SMTPã‚µãƒ¼ãƒãƒ¼ï¼‰
- ç›£è¦–å¯¾è±¡ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯APIï¼ˆãªã‘ã‚Œã°ä¾‹ã‚’æä¾›ã—ã¾ã™ï¼‰

## ã‚¹ãƒ†ãƒƒãƒ—1: ç›£è¦–æˆ¦ç•¥ã®è¨ˆç”»

ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå‰ã«ã€ä½•ã‚’ç›£è¦–ã™ã‚‹ã‹ã‚’è¨ˆç”»ã—ã¾ã—ã‚‡ã†ï¼š

### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒã¤æ¶ç©ºã®eã‚³ãƒãƒ¼ã‚¹APIã‚’ç›£è¦–ã—ã¾ã™ï¼š

- `GET /health` - åŸºæœ¬ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- `GET /api/products` - å•†å“ã‚«ã‚¿ãƒ­ã‚°ã®å¯ç”¨æ€§  
- `GET /api/users/me` - ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
- `GET /api/orders/recent` - æ³¨æ–‡å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 
- `POST /api/search` - æ¤œç´¢æ©Ÿèƒ½

### æˆåŠŸåŸºæº–

ç›£è¦–ã§ã¯ä»¥ä¸‹ã‚’æ¤œè¨¼ã—ã¾ã™ï¼š

- **å¯ç”¨æ€§**: ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒè¨±å®¹ç¯„å›²å†…ã§ã‚ã‚‹ã“ã¨
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æœŸå¾…ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒå«ã¾ã‚Œã‚‹ã“ã¨
- **èªè¨¼**: ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒé©åˆ‡ãªèªè¨¼ã‚’è¦æ±‚ã™ã‚‹ã“ã¨

## ã‚¹ãƒ†ãƒƒãƒ—2: åŸºæœ¬ç›£è¦–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä½œæˆ

ã‚·ãƒ³ãƒ—ãƒ«ãªç›£è¦–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼š

```yaml
# monitoring.yml
name: "E-commerce API Monitoring"
description: |
  ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã€ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã‚’å«ã‚€
  eã‚³ãƒãƒ¼ã‚¹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®åŒ…æ‹¬çš„ç›£è¦–ã€‚

vars:
  # APIè¨­å®š
  API_BASE_URL: "https://api.example.com"
  API_VERSION: "v1"
  
  # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã—ãã„å€¤
  MAX_RESPONSE_TIME: 2000  # 2ç§’
  CRITICAL_RESPONSE_TIME: 5000  # 5ç§’
  
  # èªè¨¼
  API_TOKEN: "{{API_AUTH_TOKEN}}"

jobs:
- name: "Basic Health Check"
  defaults:
    http:
      timeout: "10s"
      headers:
        User-Agent: "Probe Monitor v1.0"
        Accept: "application/json"
  steps:
    - name: "Check API Health Endpoint"
      id: health
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/health"
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME
      outputs:
        status: res.body.json.status
        response_time: res.time
        healthy: res.code == 200 && res.body.json.status == "healthy"
```

**ã“ã‚Œã‚’`monitoring.yml`ã¨ã—ã¦ä¿å­˜ã—ã¦ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š**

```bash
# APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®š
export API_AUTH_TOKEN="your-api-token-here"

# åŸºæœ¬ç›£è¦–ã‚’å®Ÿè¡Œ
probe monitoring.yml
```

## ã‚¹ãƒ†ãƒƒãƒ—3: åŒ…æ‹¬çš„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç›£è¦–ã®è¿½åŠ 

ã™ã¹ã¦ã®é‡è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç›£è¦–ã™ã‚‹ã‚ˆã†ã«æ‹¡å¼µã—ã¾ã—ã‚‡ã†ï¼š

```yaml
# monitoring.ymlãƒ•ã‚¡ã‚¤ãƒ«ã®health-checkã‚¸ãƒ§ãƒ–ã®å¾Œã«è¿½åŠ 

- name: "API Endpoint Monitoring"
  needs: [basic-health-check]
  if: outputs.basic-health-check.healthy == true
  steps:
    - name: "Test Product Catalog"
      id: products
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/products"
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME &&
        res.body.json.products != null &&
        res.body.json.products.length > 0
      outputs:
        product_count: res.body.json.products.length
        response_time: res.time
        available: res.code == 200

    - name: "Test User Authentication"
      id: auth
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/users/me"
        headers:
          Authorization: "Bearer {{vars.API_TOKEN}}"
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME &&
        res.body.json.user != null &&
        res.body.json.user.id != null
      outputs:
        authenticated: res.code == 200
        user_id: res.body.json.user.id
        response_time: res.time

    - name: "Test Order System"
      id: orders
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/orders/recent"
        headers:
          Authorization: "Bearer {{vars.API_TOKEN}}"
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME &&
        res.body.json.orders != null
      outputs:
        order_count: res.body.json.orders.length
        response_time: res.time
        available: res.code == 200

    - name: "Test Search Functionality"
      id: search
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/search"
        method: "POST"
        headers:
          Authorization: "Bearer {{vars.API_TOKEN}}"
          Content-Type: "application/json"
        body: |
          {
            "query": "test product",
            "limit": 10
          }
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME &&
        res.body.json.results != null
      outputs:
        result_count: res.body.json.results.length
        response_time: res.time
        available: res.code == 200
```

## ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æã®è¿½åŠ 

å…¨ä½“çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åˆ†æã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼š

```yaml
# monitoring.ymlãƒ•ã‚¡ã‚¤ãƒ«ã«ã“ã®ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 

- name: "Performance Analysis"
  needs: [api-endpoint-monitoring]
  steps:
    - name: "Calculate Performance Metrics"
      id: metrics
      echo: "Analyzing performance metrics"
      outputs:
        # å…¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚’è¨ˆç®—
        avg_response_time: |
          {{(outputs.health.response_time +
             outputs.products.response_time +
             outputs.auth.response_time +
             outputs.orders.response_time +
             outputs.search.response_time) / 5}}
        
        # æˆåŠŸã—ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        successful_endpoints: |
          {{(outputs.health.healthy ? 1 : 0) +
            (outputs.products.available ? 1 : 0) +
            (outputs.auth.authenticated ? 1 : 0) +
            (outputs.orders.available ? 1 : 0) +
            (outputs.search.available ? 1 : 0)}}
        
        # æˆåŠŸç‡ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’è¨ˆç®—
        success_rate: |
          {{(outputs.metrics.successful_endpoints / 5) * 100}}
        
        # å…¨ä½“çš„ãªãƒ˜ãƒ«ã‚¹çŠ¶æ…‹ã‚’æ±ºå®š
        overall_status: |
          {{outputs.metrics.success_rate == 100 ? "healthy" :
            outputs.metrics.success_rate >= 80 ? "degraded" : "critical"}}

    - name: "Performance Report"
      echo: |
        === MONITORING REPORT ===
        
        Overall Status: {{outputs.metrics.overall_status | upper}}
        Success Rate: {{outputs.metrics.success_rate}}%
        Average Response Time: {{outputs.metrics.avg_response_time}}ms
        
        Endpoint Details:
        âœ“ Health Check: {{outputs.health.healthy ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.health.response_time}}ms)
        âœ“ Products API: {{outputs.products.available ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.products.response_time}}ms)
        âœ“ Authentication: {{outputs.auth.authenticated ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.auth.response_time}}ms)
        âœ“ Orders API: {{outputs.orders.available ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.orders.response_time}}ms)
        âœ“ Search API: {{outputs.search.available ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.search.response_time}}ms)
        
        Data Summary:
        - Products Available: {{outputs.products.product_count}}
        - Recent Orders: {{outputs.orders.order_count}}
        - Search Results: {{outputs.search.result_count}}
        
        Generated: {{unixtime()}}
```

## ã‚¹ãƒ†ãƒƒãƒ—5: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤ã®è¿½åŠ 

ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ç›£è¦–ã‚’ã‚ˆã‚Šå …ç‰¢ã«ã—ã¾ã—ã‚‡ã†ï¼š

```yaml
# api-endpoint-monitoringã‚¸ãƒ§ãƒ–ã‚’ã“ã®æ‹¡å¼µç‰ˆã§ç½®ãæ›ãˆã‚‹

- name: "API Endpoint Monitoring"
  needs: [basic-health-check]
  if: outputs.basic-health-check.healthy == true
  steps:
    - name: "Test Product Catalog"
      id: products
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/products"
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME &&
        res.body.json.products != null &&
        res.body.json.products.length > 0
      continue_on_error: true
      outputs:
        product_count: res.body.json.products ? res.body.json.products.length : 0
        response_time: res.time
        available: res.code == 200
        status_code: res.code

    - name: "Retry Product Catalog (if failed)"
      id: products-retry
      if: "!outputs.products.available"
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/products"
        timeout: "30s"  # ãƒªãƒˆãƒ©ã‚¤ç”¨ã®é•·ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
      test: res.code == 200
      continue_on_error: true
      outputs:
        retry_successful: res.code == 200
        retry_time: res.time

    - name: "Test User Authentication"
      id: auth
      uses: http
      with:
        url: "{{vars.API_BASE_URL}}/api/{{vars.API_VERSION}}/users/me"
        headers:
          Authorization: "Bearer {{vars.API_TOKEN}}"
      test: |
        res.code == 200 &&
        res.time < vars.MAX_RESPONSE_TIME &&
        res.body.json.user != null &&
        res.body.json.user.id != null
      continue_on_error: true
      outputs:
        authenticated: res.code == 200
        user_id: res.body.json.user ? res.body.json.user.id : "unknown"
        response_time: res.time
        status_code: res.code

    # ä»–ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚‚åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç¶šã‘ã‚‹...
```

## ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®è¿½åŠ 

å•é¡ŒãŒæ¤œå‡ºã•ã‚ŒãŸã¨ãã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ï¼š

```yaml
# ç›£è¦–ã§å•é¡ŒãŒæ¤œå‡ºã•ã‚ŒãŸã¨ãã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡ã™ã‚‹ã‚¸ãƒ§ãƒ–ã‚’è¿½åŠ 

- name: "Alert Notifications"
  needs: [performance-analysis]
  if: |
    outputs.metrics.overall_status == "critical" ||
    outputs.metrics.success_rate < 80
  steps:
    - name: "Send Critical Alert Email"
      uses: smtp
      with:
        host: "{{SMTP_HOST ?? 'smtp.gmail.com'}}"
        port: "{{SMTP_PORT ?? 587}}"
        username: "{{SMTP_USERNAME}}"
        password: "{{SMTP_PASSWORD}}"
        from: "{{ALERT_FROM_EMAIL}}"
        to: ["{{ALERT_TO_EMAIL}}"]
        subject: "ğŸš¨ CRITICAL: API Monitoring Alert - {{outputs.metrics.overall_status | upper}}"
        body: |
          CRITICAL API MONITORING ALERT
          ========================
          
          Alert Summary:
          Overall Status: {{outputs.metrics.overall_status | upper}}
          Success Rate: {{outputs.metrics.success_rate}}%
          Average Response Time: {{outputs.metrics.avg_response_time}}ms
          Time: {{unixtime()}}
          
          Endpoint Status:
          Health Check: {{outputs.health.healthy ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.health.response_time}}ms)
          Products API: {{outputs.products.available ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.products.response_time}}ms)
          Authentication: {{outputs.auth.authenticated ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.auth.response_time}}ms)
          Orders API: {{outputs.orders.available ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.orders.response_time}}ms)
          Search API: {{outputs.search.available ? "âœ… UP" : "âŒ DOWN"}} ({{outputs.search.response_time}}ms)
          
          Data Summary:
          - Products Available: {{outputs.products.product_count}}
          - Recent Orders: {{outputs.orders.order_count}}
          - Search Results: {{outputs.search.result_count}}
          
          Recommended Actions:
          {{!outputs.health.healthy ? "â€¢ Check API server health and connectivity" : ""}}
          {{!outputs.products.available ? "â€¢ Investigate product catalog service" : ""}}
          {{!outputs.auth.authenticated ? "â€¢ Verify authentication service and token validity" : ""}}
          {{!outputs.orders.available ? "â€¢ Check order processing system" : ""}}
          {{!outputs.search.available ? "â€¢ Investigate search service functionality" : ""}}
          {{outputs.metrics.avg_response_time > 3000 ? "â€¢ Performance issue detected - investigate slow responses" : ""}}
          
          This alert was generated by Probe Monitoring System.
          Generated: {{unixtime()}}

    - name: "Log Alert Sent"
      echo: |
        ğŸš¨ CRITICAL ALERT SENT
        Status: {{outputs.metrics.overall_status}}
        Success Rate: {{outputs.metrics.success_rate}}%
        Alert sent to: {{ALERT_TO_EMAIL}}
```

## ã‚¹ãƒ†ãƒƒãƒ—7: ç’°å¢ƒè¨­å®š

ç’°å¢ƒå›ºæœ‰ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ï¼š

**development.yml:**
```yaml
vars:
  API_BASE_URL: "http://localhost:3000"
  API_VERSION: "v1"
  MAX_RESPONSE_TIME: 5000  # é–‹ç™ºç’°å¢ƒã§ã¯å¯›å®¹
  CRITICAL_RESPONSE_TIME: 10000

jobs:
- name: "Basic Health Check"
  defaults:
    http:
      timeout: "30s"  # é–‹ç™ºç’°å¢ƒã§ã¯ã‚ˆã‚Šé•·ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
      verify_ssl: false  # è‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’è¨±å¯
```

**staging.yml:**
```yaml
vars:
  API_BASE_URL: "https://api-staging.example.com"
  API_VERSION: "v1"
  MAX_RESPONSE_TIME: 3000
  CRITICAL_RESPONSE_TIME: 7000

jobs:
- name: "Basic Health Check"
  defaults:
    http:
      timeout: "15s"
```

**production.yml:**
```yaml
vars:
  API_BASE_URL: "https://api.example.com"
  API_VERSION: "v1"
  MAX_RESPONSE_TIME: 2000
  CRITICAL_RESPONSE_TIME: 5000

jobs:
- name: "Basic Health Check"
  defaults:
    http:
      timeout: "10s"
      verify_ssl: true
```

## ã‚¹ãƒ†ãƒƒãƒ—8: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

**setup-monitoring.sh:**
```bash
#!/bin/bash

# APIè¨­å®š
export API_AUTH_TOKEN="your-api-token-here"

# ãƒ¡ãƒ¼ãƒ«è¨­å®š
export SMTP_HOST="smtp.gmail.com"
export SMTP_PORT=587
export SMTP_USERNAME="your-email@gmail.com"
export SMTP_PASSWORD="your-app-password"
export ALERT_FROM_EMAIL="alerts@yourcompany.com"
export ALERT_TO_EMAIL="admin@yourcompany.com"

# ç’°å¢ƒé¸æŠ
export ENVIRONMENT=${1:-development}

echo "Environment configured for: $ENVIRONMENT"
echo "API Token: ${API_AUTH_TOKEN:0:10}..."
echo "Alert Email: $ALERT_TO_EMAIL"
```

## ã‚¹ãƒ†ãƒƒãƒ—9: ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè¡Œ

å®Œå…¨ãªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š

```bash
# ç’°å¢ƒã‚’è¨­å®š
chmod +x setup-monitoring.sh
source setup-monitoring.sh production

# ç‰¹å®šã®ç’°å¢ƒã§ã®ç›£è¦–å®Ÿè¡Œ
probe monitoring.yml,production.yml

# è©³ç´°å‡ºåŠ›ã§å®Ÿè¡Œ
probe -v monitoring.yml,staging.yml

# é–‹ç™ºç’°å¢ƒã§ã®å®Ÿè¡Œ
source setup-monitoring.sh development
probe monitoring.yml,development.yml
```

## ã‚¹ãƒ†ãƒƒãƒ—10: Cronã§è‡ªå‹•åŒ–

cronã§è‡ªå‹•ç›£è¦–ã‚’è¨­å®šã—ã¾ã™ï¼š

```bash
# crontabã‚’ç·¨é›†
crontab -e

# å®šæœŸç›£è¦–ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ 
# å–¶æ¥­æ™‚é–“ä¸­ã¯5åˆ†æ¯ã«å®Ÿè¡Œ
*/5 9-17 * * 1-5 /path/to/setup-monitoring.sh production && probe /path/to/monitoring.yml,/path/to/production.yml >> /var/log/probe-monitoring.log 2>&1

# å–¶æ¥­æ™‚é–“å¤–ã¯15åˆ†æ¯ã«å®Ÿè¡Œ
*/15 0-8,18-23 * * * /path/to/setup-monitoring.sh production && probe /path/to/monitoring.yml,/path/to/production.yml >> /var/log/probe-monitoring.log 2>&1

# é€±æœ«ã¯1æ™‚é–“æ¯ã«å®Ÿè¡Œ
0 * * * 0,6 /path/to/setup-monitoring.sh production && probe /path/to/monitoring.yml,/path/to/production.yml >> /var/log/probe-monitoring.log 2>&1
```

## ãƒ†ã‚¹ãƒˆã¨æ¤œè¨¼

### å€‹åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®ã¿ãƒ†ã‚¹ãƒˆ
probe -v monitoring.yml --jobs=basic-health-check

# ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆãªã—ã§ãƒ†ã‚¹ãƒˆ
probe monitoring.yml,production.yml --skip-jobs=alert-notifications

# å½ã®å¤±æ•—ã§ãƒ†ã‚¹ãƒˆï¼ˆå­˜åœ¨ã—ãªã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«URLã‚’å¤‰æ›´ï¼‰
probe monitoring.yml,development.yml
```

### ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ©ãƒ¼ãƒˆã®æ¤œè¨¼

1. æˆåŠŸã—ãã„å€¤ã‚’ä¸€æ™‚çš„ã«éå¸¸ã«é«˜ãè¨­å®šã—ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç™ºç”Ÿã•ã›ã‚‹
2. ç›£è¦–ã‚’å®Ÿè¡Œã—ã¦ãƒ¡ãƒ¼ãƒ«é…ä¿¡ã‚’ç¢ºèª
3. ãƒ¡ãƒ¼ãƒ«ã®æ›¸å¼ã¨å†…å®¹ã‚’ãƒã‚§ãƒƒã‚¯
4. é€šå¸¸ã®ã—ãã„å€¤ã‚’å¾©å…ƒ

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

**èªè¨¼å¤±æ•—:**
```bash
# APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
curl -H "Authorization: Bearer $API_AUTH_TOKEN" https://api.example.com/api/v1/users/me

# ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª
echo $API_AUTH_TOKEN | base64 -d  # JWTãƒˆãƒ¼ã‚¯ãƒ³ã®å ´åˆ
```

**ãƒ¡ãƒ¼ãƒ«é…ä¿¡ã®å•é¡Œ:**
```bash
# SMTPæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
telnet smtp.gmail.com 587

# ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆGmailã®å ´åˆï¼‰
# Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã§æ–°ã—ã„ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
```

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ:**
```bash
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ãƒã‚§ãƒƒã‚¯
ping api.example.com

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã‚’æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆ
curl -w "@curl-format.txt" -o /dev/null -s https://api.example.com/health
```

**JSONè§£æã‚¨ãƒ©ãƒ¼:**
```bash
# APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ‰‹å‹•ã§æ¤œè¨¼
curl -H "Authorization: Bearer $API_AUTH_TOKEN" https://api.example.com/api/v1/products | jq .
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼åŒ…æ‹¬çš„ãªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚æ‹¡å¼µæ–¹æ³•ï¼š

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›£è¦–ã®è¿½åŠ ** - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç›£è¦–
2. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ** - Grafanaãªã©ã®ãƒ„ãƒ¼ãƒ«ã«ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’é€ä¿¡
3. **ã‚¢ãƒ©ãƒ¼ãƒˆãƒãƒ£ãƒãƒ«ã®è¿½åŠ ** - Slackã€PagerDutyã€ã¾ãŸã¯webhooké€šçŸ¥
4. **ã‚¹ãƒãƒ¼ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã®å®Ÿè£…** - é€£ç¶šã—ãŸè¤‡æ•°ã®å¤±æ•—å¾Œã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆ
5. **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã®è¿½åŠ ** - å˜ãªã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã¯ãªãé‡è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
6. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å›å¸°æ¤œå‡º** - æ™‚é–“ã®çµŒéã«ä¼´ã†ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®æ¯”è¼ƒ
7. **SSLè¨¼æ˜æ›¸ç›£è¦–** - è¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™æ—¥ã®ãƒã‚§ãƒƒã‚¯

## é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

- **[APIãƒ†ã‚¹ãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](../api-testing-pipeline/)** - é«˜åº¦ãªAPIãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **[ãƒãƒ«ãƒç’°å¢ƒãƒ†ã‚¹ãƒˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](../multi-environment-testing/)** - è¤‡æ•°ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ
- **[ãƒã‚¦ãƒ„ãƒ¼: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ](../../how-tos/performance-testing/)** - è©³ç´°ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
- **[ãƒã‚¦ãƒ„ãƒ¼: ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](../../how-tos/monitoring-workflows/)** - è¿½åŠ ã®ç›£è¦–ãƒ‘ã‚¿ãƒ¼ãƒ³